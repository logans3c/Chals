{% extends 'base.html' %}

{% block title %}My Notes - NINJA Auth App{% endblock %}

{% block content %}
<section class="notes-container">
    <div class="notes-header">
        <h2>My Notes</h2>
    </div>

    <div class="notes-form-container">
        <form method="post" action="{{ url_for('notes') }}" class="note-form">
            <div class="form-group">
                <label for="content">New Note</label>
                <textarea id="content" name="content" rows="4" required placeholder="Write your note here..."></textarea>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn primary">Add Note</button>
            </div>
        </form>
    </div>

    <div class="top-users-container">
        <h3>Top 3 Active Users</h3>
        <div id="top-users-list" class="top-users-list">
            <p>Loading top users...</p>
        </div>
    </div>

    <div class="notes-list">
        <h3>Your Notes ({{ notes|length }})</h3>
        {% if notes %}
            {% for note in notes %}
                <div class="note-card">
                    <div class="note-content">{{ note.content }}</div>
                    <div class="note-meta">
                        <span class="note-date">{{ note.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                        <form method="post" action="{{ url_for('delete_note', note_id=note.id) }}" class="delete-note-form">
                            <button type="submit" class="btn danger small">Delete</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p class="no-notes-message">You haven't created any notes yet. Write your first note above!</p>
        {% endif %}
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Fetch top users
        fetch('/top_users')
            .then(response => response.json())
            .then(data => {
                const topUsersList = document.getElementById('top-users-list');
                if (data.length === 0) {
                    topUsersList.innerHTML = '<p>No users have created notes yet.</p>';
                } else {
                    let html = '<ol class="top-users">';
                    data.forEach(user => {
                        html += `<li><span class="username">${user.username}</span> - <span class="note-count">${user.note_count} notes</span></li>`;
                    });
                    html += '</ol>';
                    topUsersList.innerHTML = html;
                }
            })
            .catch(error => {
                console.error('Error fetching top users:', error);
                document.getElementById('top-users-list').innerHTML = '<p>Error loading top users.</p>';
            });
    });
</script>
{% endblock %}
