<!-- templates/thumbnail_gallery.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Thumbnail Gallery</title>
    <style>
        .gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        .thumbnail {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            width: 150px;
            text-align: center;
            cursor: pointer;
        }
        .thumbnail:hover {
            background-color: #f5f5f5;
        }
        .thumbnail img {
            max-width: 100%;
            height: 100px;
            object-fit: cover;
        }
        .selected {
            border: 3px solid #4CAF50;
        }
    </style>
</head>
<body>
    <h1>Choose a Thumbnail</h1>
    <p>Click on a thumbnail to select it for your entry.</p>
    
    <div class="gallery">
        {% for thumb in thumbnails %}
        <div class="thumbnail" onclick="selectThumbnail('{{ thumb }}')">
            <img src="/thumbnail?path={{ thumb }}" alt="{{ thumb }}">
            <p>{{ thumb }}</p>
        </div>
        {% endfor %}
    </div>
    
    <div style="margin-top: 20px;">
        <button onclick="window.close()">Cancel</button>
        <button onclick="useSelected()">Use Selected</button>
    </div>
    
    <script>
        let selectedThumb = null;
        
        function selectThumbnail(thumb) {
            // Remove selected class from all thumbnails
            document.querySelectorAll('.thumbnail').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Find the clicked thumbnail and add selected class
            const thumbEl = Array.from(document.querySelectorAll('.thumbnail'))
                .find(el => el.querySelector('p').textContent === thumb);
            
            if (thumbEl) {
                thumbEl.classList.add('selected');
                selectedThumb = thumb;
            }
        }
        
        function useSelected() {
            if (selectedThumb) {
                // Pass the selected thumbnail back to the opener window
                if (window.opener && !window.opener.closed) {
                    window.opener.document.getElementById('thumb_filename').value = selectedThumb;
                }
                window.close();
            } else {
                alert('Please select a thumbnail first.');
            }
        }
    </script>
</body>
</html>